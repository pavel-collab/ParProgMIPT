# Лабораторная работа. Численное решение уравнения переноса с использованием параллельных алгоритмов.

В данной работе мы рассмотрим численное решение уравнения переноса (дифференциальное уравнение
в частных производных). А так же сравним алгоритмы численного решения для однопоточной и
многопоточной програм.

## Теория

В данной работе будем решать дифференциальное уравнение

$$
\begin{cases}
\frac{\partial u}{\partial t} + \frac{\partial u}{\partial t} = x + t \\
u(0, x) = \phi(x) = \cos{\pi x} \\
u(t, 0) = \psi(t) = e^{-t}
\end{cases}
$$

Програмно в однопоточной и многопоточной программе реализованы 3 расчетные схемы:
- явный левый уголок
- четырехточечная схема
- крест

Приведем разностную формулу для расчетной схемы "крест"

$$
x = x = x = x 
$$

## Инструкция к запуску

- images -- папка с картинками (графики и результаты исследования)
    - validation -- в данной папке хранятся 3d графики решения уравнения переноса. На одном графике построено решение, полученное в результате работы последовательной программы и решение, полученное в результате работы параллельной программы. Сделано это для того, чтобы показать, что обычная и параллельная программа дают верное решение задачи. Присутствуют решения для разных сеток.
    - acceleration -- в данной папке хранятся результаты сравнения времени работы обычной и параллельной програм.
- python -- в данной папке хранятся python скрипты для запуска эксперементов и построения сравнительных графиков. __Внимание__, в каждом python скрипте идет вызов c++ программы (обычной или параллельной).
- Makefile
- Consistent.cpp -- обычная (однопоточная) программа численного решения уравнения переноса.
- main.cpp -- параллельная программа численного решения уравнения переноса.

Собрать обе программы (Consistent.cpp и main.cpp) можно командой
```
make
```

Запуск однопоточной программы
```
./a.out 1000 1000
```
Запуск многопоточной программы
```
mpiexec -n 4 ./main 1000 1000
```

Через аргументы командной строки мы задаем количество точек на временном и пространственном 
диапазонах соответственно.
__ATTENTION:__ в силу ~~корявой~~ реализации программы вам необходимо убедиться, что количество 
точек на пространственном и временном диапазонах делится на цело на количество процессов (при 
параллельном запуске).

В результате работы любой программы мы получаем численное решение уравнение переноса, а так же 
время работы программы (оно необходимо для исследования ускорения параллельной программы). 
Однопоточная программа записывает численное решение в файл _validate.txt_, параллельная программа
записывает решение в файл _data.txt_. Обе программы пишут свое время работы в файл _time.txt_.

__ATTENTION:__ при очередном запуске программы не забывайте удалить из рабочей дериктории .txt
файлы со старыми результатами.

#### Python скрипты

В папке _python_ вы можете найти 3 python программы.

Программа _ViewResult.py_ выводит 3d график решения уравнения переноса и позволяет интерактивно 
исследовать его. Данная программа работает с заранее полученным численным решением, поэтому 
получите файл с численным решением _data.txt_ или _validation.txt_ заранее.

```
make
./a.out 100 100
mpiexec -n 2 ./main 1000 1000
cd python
pytohn3 ViewResult.py -d ../validate.txt
pytohn3 ViewResult.py -d ../data.txt
```

После закрытия интерактивного графика, он сохранится в папке _images_ с именем _solution.jpg_.

Программа _CheckValidation.py_ запускает однопоточную и многопотоную программу на разных сетках,
а затем строит на одном графике решения, полученные в результате работы этих программ. Скрипт 
служет для сравнения решений. Картинки с графиками будут сохранены в _/images/validation/_
Поскольку скрипт самостоятельно запускает c++ программы, не нужно запускать их заранее. Однако
обе программы должны быть скомпилированы в рабочей дериктории.

```
make
cd python
python3 CheckValidation.py
```

__ATTENTION:__ после того, как скрипт отработает, не забудьте удалить из дериктории _python_ все
.txt файлы.

Программа _Experiment1.py_ запускает однопоточную и многопоточную программы на заданном числе 
потоков и на разных сетках и строит график зависимости времени их работы от количества точек на сетке. В аргументы данного скрипта необходимо передать количество потоков, на котором будет 
запускаться параллельная программа. Картинки с графиками будут сохранены в 
_/images/acceleration/_. Поскольку скрипт самостоятельно запускает c++ программы, не нужно запускать их заранее. Однако обе программы должны быть скомпилированы в рабочей дериктории.

```
make
cd python
python3 Experiment1.py -n 4
```

__ATTENTION:__ после того, как скрипт отработает, не забудьте удалить из дериктории _python_ все
.txt файлы.

Программа _Experiment2.py_ запускает однопоточную и многопоточную программу на разном количестве 
процессов на одной сетке и строит график зависимости отношения времени работы однопоточной и 
многопоточной програм от количества процессов. Картинки с графиками будут сохранены в 
_/images/acceleration/_. Поскольку скрипт самостоятельно запускает c++ программы, не нужно запускать их заранее. Однако обе программы должны быть скомпилированы в рабочей дериктории.

```
make
cd python
python3 Experiment2.py
```

__ATTENTION:__ после того, как скрипт отработает, не забудьте удалить из дериктории _python_ все
.txt файлы.

##  Результаты исследования