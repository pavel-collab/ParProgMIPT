# README

В данной работе исследуется поведение функции MPI_Send, а так же других коммуникационных режимов.

# Description

Параллельная программа _Send.c_ запускается __строго на двух потоках__
```
mpiexec -n 2 ./send N mode
```
Один поток посылает другому сообщение, содержащее целочисленный массив длинной _N_ (задается 
первым аргументом программы). При пересылке можно использовать различные коммуникационные режимы.
Режим пересылки задается параметром _mode_ (второй аргумент командной строки). Есть возможность 
выбрать из 4 видов коммуникации:
- standart -- стандартный
- buf -- пересылка с использованием буффера
- synch -- синхронная пересылка
- ready -- пересылка по готовности
В программе организована задержка между началом отправки одним процессом и началом получения 
другим процессов. Задержка составляет 2 секунды. Кроме того, в программе с помощью инстументов MPI
замеряется время работы функции посылки и функции приема. Данные записываются в файлы _send.txt_ и 
_resv.txt_.

Пример запуска
```
touch send.txt resv.txt
make
mpiexec -n 2 ./send 256 standart
```

# Instruction

Для удобства проведения эксперемента был написан питоновский скрипт, который автоматически 
запускает параллельную программу на на разных длинах массива и с разными коммуникационными режимами
и строит график зависимости времени работы функции от длины пересылаемого массива. Графики 
сохраняются в дерикторию _images_.

Пример запуска эксперемента
```
touch send.txt resv.txt
make
python3 main.py
```

## Attention 1

График для коммуникационного режима с буфферизацией строится отдельно, поскольку в MPI есть
ограничение на размер буффера.

## Attention 2

Параллельная программа может вести себя недетерминировано. Разные запуски эксперемента будут давать
разные графики. К тому же какой-то определенной математической зависимости, которую можно было бы
апроксимировать, видно не будет. По графикам можно судить лишь о росте или падении времени _в среднем_ и _примерно_.

# Theory

Всего есть 4 способа пересылки данных типа точка-точка:
- MPI_Send -- стандартный режим
- MPI_Bsend -- буфферизованный режим
- MPI_Ssend -- синхронный режим
- MPI_Rsend -- режим по готовности

## MPI_Send

При отправке сообщения в стандартном режиме может произойти одно из двух событий:
- сообщение от отправителя будет скопировано в промежуточный буффер и уже оттуда скопировано в 
буффер получателя
- сообщение от отправителя будет скопировано в буффер получателя напрямую

Соответственно, в стандартном режиме MPI_Send может вернуть управление еще до того, как начнется 
прием сообщения из буффера. Решение об использовании или неиспользовании буффера принимает сам MPI.
Как правило, если сообщение маленькое, будет использован буффер. В случае же если сообщение 
достаточно большое, буффер использовать нецелесообразно, поскольку мы будем тратить много ресурсов 
на копирование данных. В этом случае MPI выберет пересылку сообщения напрямую получателю.

<p align="center">
    <img src="https://github.com/pavel-collab/ParProgMIPT/blob/main/Send/images/SendTime_standart_07.03.2023-16.18.57_.jpg" alt="caption" width="300"/>
</p>

На представленном графике хорошо виден момент, когда сообщение становится слишком большим для того,
чтобы использовать промежуточный буффер. В этот момент MPI начинает пересылать сообщения от 
отправителя получателю напрямую. Смена режима происходит при достижении сообщения размера примерно 
2 Кб.

## MPI_Bsend

В этом режиме буффер используется по умолчанию, независимо от размера сообщения. Однако, в MPI 
есть так же ограничение на размер используемого буффера. Если таким образом мы попытаемся отправить слишком большое сообщение, MPI выдаст ошибку и завершит работу программы.

## MPI_Ssend

Синхронный режим работает схоже со стандартным. Разница заключается в том, что при записи сообщения
в буффер, функция MPI_Ssend ждет, что получатель начнет читать данные из этого буффера и только 
после этого возвращает управление (не дожидаясь, пока сообщение полностью перейдет из 
промежуточного) буффера в буффер получателя. Другими словами, возвращение управления функцей 
MPI_Ssend не только показывает, что сообщение успешно скопировано в промежуточный буффер,
но также показывает, что получатель начал принимать это сообщение из промежуточного буффера.

<p align="center">
    <img src="https://github.com/pavel-collab/ParProgMIPT/blob/main/Send/images/Standart_Synch_Compare.jpg" alt="caption" width="300"/>
</p>

Поскольку между отправкой и приемом сообщения организована искусственная задержка в 2 секунды, на 
этом графике хорошо видно, как отличается поведение MPI_Send и MPI_Ssend (при том, что они оба
используют буффер на этом количестве данных).

## MPI_Rsend

При использовании режима по готовности, отправитель пересылает данные напрямую адресату, причем,
прежде, чем начать отправку, процесс-отправитель ждет, пока процесс-получатель не будет готов 
принять сообщение.